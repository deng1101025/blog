"use strict";(self.webpackChunkblog=self.webpackChunkblog||[]).push([[8802],{368:(e,t,a)=>{a.r(t),a.d(t,{data:()=>l});const l={key:"v-4606c82d",path:"/assets/vue/sourceCodeAnalysis/%E8%AE%A1%E7%AE%97%E5%B1%9E%E6%80%A7%E5%8E%9F%E7%90%86%E4%BB%8B%E7%BB%8D.html",title:"计算属性原理介绍",lang:"zh-CN",frontmatter:{lang:"zh-CN",title:"计算属性原理介绍",description:"计算属性原理介绍"},excerpt:"",headers:[{level:2,title:"计算属性",slug:"计算属性",children:[]},{level:2,title:"计算属性原理图",slug:"计算属性原理图",children:[]}],filePathRelative:"assets/vue/sourceCodeAnalysis/计算属性原理介绍.md",git:{updatedTime:164121974e4,contributors:[{name:"邓占伟",email:"332877552@qq.com",commits:1}]}}},1724:(e,t,a)=>{a.r(t),a.d(t,{default:()=>u});var l=a(6252),r=a(3542);const c=(0,l._)("h2",{id:"计算属性",tabindex:"-1"},[(0,l._)("a",{class:"header-anchor",href:"#计算属性","aria-hidden":"true"},"#"),(0,l.Uk)(" 计算属性")],-1),n=(0,l._)("ol",null,[(0,l._)("li",null,"组件初始化会初始化computed"),(0,l._)("li",null,"初始化computed会循环所有的计算属性，代理到组件实例，并拦截（目的是访问的时候可以出发计算属性的getter方法）"),(0,l._)("li",null,"初始化computed还会new一个Watcher对象，我们知道Watcher的构造函数会执行Watcher实例的get方法，但是由于计算属性的lazy为true，并不会执行"),(0,l._)("li",null,"出发组件的Watcher的时候会生成vnode（ data（包括计算属性）和ast（抽象语法书）生成vnode ），就肯定会访问data和计算属性，并触发第 2 步的代理中的get方法"),(0,l._)("li",null,"然后判断dirty如果为true，就会执行wathcer的evaluate方法，里面会执行计算属性的结果并赋值给watcher实例，且把dirty改为false，为了缓存结果，提升性能"),(0,l._)("li",null,"如果改变了计算属性所依赖的data的时候，会触发派发更新，循环所有计算属性的watcher，重新计算，重新赋值给该计算属性，就会触发试图刷新（这里有一点需要看依赖收集和派发更新原理，因为很多同学可能会有疑问，那些被计算属性依赖的data怎么知道自己被依赖了，下面第7步，简单介绍，不做复杂分析）"),(0,l._)("li",null,"当出发依赖收集之前，一定出发了Watcher的get方法，在get方法中会改变全局变量 Dep.target,这个属性是用来存储当前正在进行依赖收集的Watcer，所以在访问data的时候会出发Object.defineProperty的get（此时会形成闭包）方法，并将Dep和全局Watcher相互关联，当获取计算属性的时候会出发计算属性的Watcher，所以当前全局的Watcher就是计算属性的Watcher，所以可以知道哪些属性被计算属性收集了，具体分析可以看派发更新和依赖收集原理")],-1),i=(0,l._)("h2",{id:"计算属性原理图",tabindex:"-1"},[(0,l._)("a",{class:"header-anchor",href:"#计算属性原理图","aria-hidden":"true"},"#"),(0,l.Uk)(" 计算属性原理图")],-1),d=(0,l._)("p",null,[(0,l._)("img",{src:r,alt:"计算属性"})],-1),s={},u=(0,a(3744).Z)(s,[["render",function(e,t){return(0,l.wg)(),(0,l.iD)(l.HY,null,[c,n,i,d],64)}]])},3744:(e,t)=>{t.Z=(e,t)=>{for(const[a,l]of t)e[a]=l;return e}},3542:(e,t,a)=>{e.exports=a.p+"assets/img/computed.caf03436.png"}}]);